-- Prepare statements Postgres SQL Pizzeria Project

PREPARE list_sides AS
SELECT name FROM Side;

PREPARE list_toppings AS
SELECT name FROM Topping;

PREPARE list_sauces AS
SELECT name FROM SauceType;

PREPARE list_dough AS
SELECT name FROM doughType;

PREPARE list_dough_sizes AS
SELECT name FROM doughSize;

PREPARE getOrder_Pizza (VARCHAR) AS
SELECT ordernumber, phonenumber, dateordered, pizzaNumber, DS.name AS "doughSize", DT.name AS "doughType", ST.name AS "sauceType", T.name AS "Topping"
            FROM Pizza P
                JOIN "Order" O ON (O.ID = P.orderID)
                JOIN Sauce S ON (P.sauceID = S.ID)
                JOIN SauceType ST ON (S.sauceTypeID = ST.ID)
                JOIN Dough D ON (P.doughID = D.ID)
                JOIN DoughSize DS ON (D.doughSizeID = DS.ID)
                JOIN DoughType DT ON (D.doughTypeID = DT.ID)
                JOIN AddedToppings AD ON (AD.pizzaID = P.ID)
                JOIN Topping T ON (T.ID = AD.toppingID)
            WHERE orderID = (SELECT ID FROM "Order" WHERE orderNumber = $1)
            ORDER BY pizzaNumber;

PREPARE getOrder_Side (VARCHAR) AS
SELECT S.name AS "Side", ADS.quantity as "Quantity"
            FROM "Order" O
                JOIN AddedSides ADS ON (ADS.orderID = O.ID)
                JOIN Side S ON (S.ID = ADS.sideID)
            WHERE O.orderNumber = $1;

PREPARE getBoring_Order (VARCHAR) AS
SELECT ordernumber AS "orderNumber", phonenumber, dateordered AS "dateOrdered"
                FROM "Order" O
                WHERE O.ordernumber = '${orderNumber}';

-- To execute (what we'll put inside of our APIs)

EXECUTE list_sides;

EXECUTE list_toppings;

EXECUTE list_sauces;

EXECUTE list_dough;

EXECUTE list_dough_sizes;

EXECUTE getOrder_Pizza(`${orderNumber}`);

EXECUTE getOrder_Side(`${orderNumber}`);

EXECUTE getBoring_Order(`${orderNumber}`);

-- DEALLOCATE PREPARE_STATEMENT_NAME to deallocate.


