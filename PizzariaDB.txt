DROP DATABASE IF EXISTS popularpizza;

SELECT current_database();

CREATE DATABASE popularpizza;

\c popularpizza

SELECT current_database();

CREATE TABLE Side (
	ID SERIAL NOT NULL UNIQUE,
	name VARCHAR(25) NOT NULL UNIQUE,
	price DECIMAL(8, 2) NOT NULL,

	PRIMARY KEY (ID)
);

CREATE TABLE Topping (
	ID SERIAL NOT NULL UNIQUE,
	name VARCHAR(25) NOT NULL UNIQUE,
	price DECIMAL(8, 2) NOT NULL,

	PRIMARY KEY (ID)
);

CREATE TABLE DoughSize (
	ID SERIAL NOT NULL UNIQUE,
	name VARCHAR(25) NOT NULL UNIQUE,
	diameterInches INTEGER NOT NULL,

	PRIMARY KEY (ID)
);

CREATE TABLE DoughType (
	ID SERIAL NOT NULL UNIQUE,
	name VARCHAR(25) NOT NULL UNIQUE,
	pricePerInch DECIMAL(8, 2) NOT NULL,

	PRIMARY KEY (ID)
);

CREATE TABLE SauceType (
	ID SERIAL NOT NULL UNIQUE,
	name VARCHAR(12) NOT NULL UNIQUE,
	price DECIMAL(8, 2) NOT NULL,

	PRIMARY KEY (ID)
);

CREATE TABLE Sauce (
	ID SERIAL NOT NULL UNIQUE,
	sauceTypeID SERIAL NOT NULL,

	PRIMARY KEY (ID),
	FOREIGN KEY (sauceTypeID) REFERENCES SauceType
	DEFERRABLE INITIALLY DEFERRED
);

CREATE TABLE Dough (
	ID SERIAL NOT NULL UNIQUE,
	doughSizeID SERIAL NOT NULL,
	doughTypeID SERIAL NOT NULL,

	PRIMARY KEY (ID),
	FOREIGN KEY (doughSizeID) REFERENCES DoughSize
	DEFERRABLE INITIALLY DEFERRED,
	FOREIGN KEY (doughTypeID) REFERENCES DoughType
	DEFERRABLE INITIALLY DEFERRED
);

CREATE TABLE "Order" (
	ID SERIAL NOT NULL UNIQUE,
	phoneNumber VARCHAR(15),
	dateOrdered DATE NOT NULL,
	orderNumber VARCHAR(12) NOT NULL UNIQUE,

	PRIMARY KEY (ID)
);

CREATE TABLE AddedSides (
	orderID SERIAL NOT NULL,
	sideID SERIAL NOT NULL,
	quantity INTEGER NOT NULL,

	PRIMARY KEY (orderID, sideID),
	FOREIGN KEY (orderID) REFERENCES "Order"
	DEFERRABLE INITIALLY DEFERRED,
	FOREIGN KEY (sideID) REFERENCES Side
	DEFERRABLE INITIALLY DEFERRED
);

CREATE TABLE Pizza (
	ID SERIAL NOT NULL UNIQUE,
	orderID SERIAL NOT NULL,
	doughID SERIAL NOT NULL,
	sauceID SERIAL,
	pizzaNumber VARCHAR(12) NOT NULL UNIQUE,

	PRIMARY KEY (ID),
	FOREIGN KEY (orderID) REFERENCES "Order"
	DEFERRABLE INITIALLY DEFERRED,
	FOREIGN KEY (doughID) REFERENCES Dough
	DEFERRABLE INITIALLY DEFERRED,
	FOREIGN KEY (sauceID) REFERENCES Sauce
	DEFERRABLE INITIALLY DEFERRED
);

CREATE TABLE AddedToppings (
	pizzaID SERIAL NOT NULL,
	toppingID SERIAL NOT NULL,

	PRIMARY KEY (pizzaID, toppingID),
	FOREIGN KEY (pizzaID) REFERENCES Pizza
	DEFERRABLE INITIALLY DEFERRED,
	FOREIGN KEY (toppingID) REFERENCES Topping
	DEFERRABLE INITIALLY DEFERRED
);